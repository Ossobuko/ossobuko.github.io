<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_lwy0emw3rlpj-3>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-3,decimal) ". "}ol.lst-kix_lwy0emw3rlpj-5.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-5 0}.lst-kix_lwy0emw3rlpj-2>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-2,lower-roman) ". "}.lst-kix_lwy0emw3rlpj-6>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-6,decimal) ". "}ol.lst-kix_lwy0emw3rlpj-0.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-0 0}ol.lst-kix_lwy0emw3rlpj-3.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-3 0}.lst-kix_lwy0emw3rlpj-7>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-7,lower-latin) ". "}.lst-kix_lwy0emw3rlpj-6>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-6}.lst-kix_lwy0emw3rlpj-0>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-0}.lst-kix_lwy0emw3rlpj-1>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-1,lower-latin) ". "}.lst-kix_lwy0emw3rlpj-0>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-0,decimal) ". "}.lst-kix_lwy0emw3rlpj-3>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-3}.lst-kix_lwy0emw3rlpj-8>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-8,lower-roman) ". "}ol.lst-kix_lwy0emw3rlpj-8.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-8 0}ol.lst-kix_lwy0emw3rlpj-2.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-2 0}ol.lst-kix_lwy0emw3rlpj-7.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-7 0}.lst-kix_lwy0emw3rlpj-1>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-1}.lst-kix_lwy0emw3rlpj-4>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-4}.lst-kix_lwy0emw3rlpj-5>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-5,lower-roman) ". "}.lst-kix_lwy0emw3rlpj-7>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-7}.lst-kix_lwy0emw3rlpj-4>li:before{content:"" counter(lst-ctn-kix_lwy0emw3rlpj-4,lower-latin) ". "}.lst-kix_lwy0emw3rlpj-2>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-2}.lst-kix_lwy0emw3rlpj-5>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-5}ol.lst-kix_lwy0emw3rlpj-4.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-4 0}.lst-kix_lwy0emw3rlpj-8>li{counter-increment:lst-ctn-kix_lwy0emw3rlpj-8}ol.lst-kix_lwy0emw3rlpj-2{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-1{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-4{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-3{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-0{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-6.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-6 0}ol.lst-kix_lwy0emw3rlpj-6{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-1.start{counter-reset:lst-ctn-kix_lwy0emw3rlpj-1 0}ol.lst-kix_lwy0emw3rlpj-5{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-8{list-style-type:none}ol.lst-kix_lwy0emw3rlpj-7{list-style-type:none}ol{margin:0;padding:0}.c9{border-right-style:solid;padding:14.4pt 14.4pt 14.4pt 14.4pt;border-bottom-color:#ffffff;border-top-width:1pt;border-right-width:1pt;border-left-color:#ffffff;vertical-align:top;border-right-color:#ffffff;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:580.5pt;border-top-color:#ffffff;border-bottom-style:solid}.c17{border-right-style:solid;padding:14.4pt 14.4pt 14.4pt 14.4pt;border-bottom-color:#ffffff;border-top-width:1pt;border-right-width:1pt;border-left-color:#ffffff;vertical-align:top;border-right-color:#ffffff;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:540pt;border-top-color:#ffffff;border-bottom-style:solid}.c1{margin-left:-18pt;padding-top:0pt;text-indent:13.5pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;direction:ltr}.c6{font-weight:normal;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c3{margin-left:-18pt;text-indent:13.5pt;orphans:2;widows:2;direction:ltr;margin-right:-22.5pt}.c2{font-weight:normal;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Courier New";font-style:normal}.c19{margin-left:-18pt;orphans:2;text-indent:13.5pt;widows:2;direction:ltr}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left;direction:ltr}.c11{margin-left:-18pt;border-collapse:collapse;margin-right:auto}.c10{background-color:#0099cc;max-width:540pt;padding:36pt 36pt 36pt 36pt}.c7{padding:0;margin:0}.c20{font-size:10pt;font-family:"Courier New"}.c12{background-color:#f3f3f3;color:#ff0000}.c21{height:54pt}.c13{height:0pt}.c18{background-color:#0099cc}.c8{list-style-position:inside}.c4{height:11pt}.c15{margin-right:-22.5pt}.c14{page-break-after:avoid}.c16{font-style:italic}.c0{color:#ffffff}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c10"><p class="c3 c14 title"><a name="h.933ev4j0jf1h"></a><span class="c0">How to control FPS properly in Libgdx</span></p><p class="c3"><span class="c12">INCOMPLETE</span></p><p class="c3 c4"><span class="c12"></span></p><p class="c3"><span class="c0 c18">By Burak Dursun </span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">There is 2 possibilities when a game is running. It can run under fps limit. It can run at or over fps limit.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">If the game is running over fps limit, let&rsquo;s say our limit is 60 fps, then all we need to do is limit it by waiting until enough time passes. For 60 fps it will be 1/60 seconds between frame draws. 0.017 seconds to be exact. So if the time between frame draws are lower than this we need to put our thread to sleep for (0.017 - timePassed). Then we can continue for next frame.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">What if the time passed is over 0.017 seconds and we are under 60 fps? The solution is we do our movements relative to the time. Let&#39;s have a character moves around screen. It has a x and y location relative to the screen. Where it goes or what it does is not our business right now but how it moves is.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">If the character moves one pixel for render loop, fps change will directly affect its movement. If the fps is more than 60 fps, it will move faster or if it&rsquo;s lower than its movement will be slower. In order to adjust its speed irrelative to fps of the machine user is running our game on, we need to define a speed per second. Let&rsquo;s want it to move one pixel per every second. (pixelPerSecond * timePassed) will give us the necessary number to move our character in that frame. For example if running at 30 fps (0.033 seconds per frame), and character should move 40 pixels in one second. In one frame character should move about (40pixels * (1/30fps)) = 1.33 pixels per frame.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">When you calculate delta time between frames, you are actually finding how long did the previous frame took to complete. Let&#39;s draw three frames and see how it works.</span></p><p class="c3 c4"><span class="c0"></span></p><ol class="c7 lst-kix_lwy0emw3rlpj-0 start" start="1"><li class="c3 c8"><span class="c0">Start game</span></li><li class="c3 c8"><span class="c0">currentTime = getTime()</span></li></ol><p class="c3 c4"><span class="c0"></span></p><ol class="c7 lst-kix_lwy0emw3rlpj-0" start="3"><li class="c3 c8"><span class="c0">deltaTime = getTime() - currentTime </span><span class="c16 c0">// deltaTime is 0 because there wasn&rsquo;t a frame before this one</span></li><li class="c3 c8"><span class="c0">currentTime = getTime()</span></li><li class="c3 c8"><span class="c0">Move character and/or do other stuff</span></li><li class="c3 c8"><span class="c0">Render</span></li><li class="c3 c8"><span class="c0">First frame is finished, start second frame</span></li></ol><p class="c3 c4"><span class="c0"></span></p><ol class="c7 lst-kix_lwy0emw3rlpj-0" start="8"><li class="c3 c8"><span class="c0">deltaTime = getTime() - currentTime </span><span class="c16 c0">// deltaTime is passed time between step 4 and 8</span></li><li class="c3 c8"><span class="c0">currentTime = getTime()</span></li><li class="c3 c8"><span class="c0">Move character and/or do other stuff</span></li><li class="c3 c8"><span class="c0">Render</span></li><li class="c3 c8"><span class="c0">Second frame is finished, start third one</span></li></ol><p class="c3 c4"><span class="c0"></span></p><ol class="c7 lst-kix_lwy0emw3rlpj-0" start="13"><li class="c3 c8"><span class="c0">deltaTime = getTime() - currentTime </span><span class="c0 c16">// deltaTime is passed time between step 9 and 13</span></li><li class="c3 c8"><span class="c0">currentTime = getTime()</span></li><li class="c3 c8"><span class="c0">Move character and/or do other stuff</span></li><li class="c3 c8"><span class="c0">Render</span></li><li class="c3 c8"><span class="c0">Third frame is finished</span></li></ol><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">As seen here when we calculate delta time we are actually calculating how long the frame before the current one took to draw. If one of the frames take more than others did,what would happen? Character would jump across the screen.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">The delta time cannot be consistent. Sometimes it will be lower sometimes higher. It will surely change every frame. What if our character is leaving a trail line? Would this inconsistency in frame rate prevent its trail line to be smooth?</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">The next picture show our character&rsquo;s trail. Somebody threw him in 45 degree angle. There is 3 forces affecting him. To up and right and gravity pulling him down. The red dots show the character&#39;s position in every frame draw. As you see, inconsistency in fps directly affects motion. And the white line shows a perfect line character should be following.</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 720.00px; height: 540.00px;"><img alt="Untitled.png" src="images/image00.png" style="width: 720.00px; height: 540.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c0">In some cases, this is not a noticeable thing. If it&rsquo;s not noticeable you shouldn&rsquo;t worry about this. But in some games where the motion should be perfect,this is a big problem.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">As a solution we need to take average of the last N frames. So micro changes in the fps doesn&rsquo;t affect the motion. This will make motion smoother. N could be any number you fit. I find out N=10 works best for the game I made. Just make sure it is not too much. </span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">So we will take average of the passed time between last 5 frames. And when we do this we shouldn&rsquo;t include frames that takes more than a quarter second to draw. (If the game is running under 4 fps, we are assuming it&rsquo;s unplayable.) Because sometimes the first frame after game is resumed could take more than it should. Or deltaTime will count the time passed while the game was paused, and give you an unreasonable delta time like 10 seconds. We should eliminate this peaks created by pausing, loading etc.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">Here are some code I used in my game HOLD THE LINE. You can easily access the Google Play link in main page. </span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3 c4"><span class="c0"></span></p><p class="c19 c4"><span></span></p><a href="#" name="f869c8cddb0ca9c680f279ee0f12d707e0c472ea"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c13"><td class="c9" colspan="1" rowspan="1"><p class="c1 c15"><span class="c2 c0">class AverageFPS {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; float[] numbers; // 0-9</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; int lastMember;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; float sum;</span></p><p class="c1 c4"><span class="c2 c0"></span></p><p class="c1"><span class="c2 c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;long currentTime = 0f;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; final int nanoToSecond = 1000000000;</span></p><p class="c1 c4"><span class="c2 c0"></span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; public AverageFPS() {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; // an array for last 10 frames</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; numbers = new float[10]; // N = 10</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; lastMember = 0;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; public float getAverage() {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; // find the passed time of this frame</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; if (currentTime == 0f) currentTime = System.nanoTime();</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; float passedTime = (float)(System.nanoTime() - currentTime) /nanoToSecond;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; currentTime = System.nanoTime();</span></p><p class="c1"><span class="c2 c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; // if it is too big do not count it in</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; if (passedTime &nbsp;&gt; 0.25) {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return findAverage();</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; // add it to array</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; numbers[lastMember++] = passedTime ;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; if (lastMember &gt; 9) lastMember = 0;</span></p><p class="c1 c4"><span class="c2 c0"></span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; // return the average</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; return findAverage();</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; private float findAverage() {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; sum = 0;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; for (int a = 0; a &lt; numbers.length; a++) {</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sum += numbers[a];</span></p><p class="c1"><span class="c0 c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; &nbsp; &nbsp; return sum / 10;</span></p><p class="c1"><span class="c2 c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c2 c0">}</span></p></td></tr></tbody></table><p class="c19 c4"><span></span></p><p class="c19"><span class="c0">Call </span><span class="c0 c20">getAverage() </span><span class="c0">function in render method. And use the returning value as time passed between frames. Do not use it when sleeping the thread.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3"><span class="c0">There is one thing remaining that we didn&rsquo;t discuss how to do; limiting fps. In libgdx you can limit the fps in configuration. Open your Launcher class for which platform you are developing the game to. Set foreground fps to desired fps limit. Libgdx will limit your fps automatically.</span></p><p class="c3 c4"><span class="c0"></span></p><a href="#" name="f755e75adc3d456187250ac0f3f584d655f391fd"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c21"><td class="c17" colspan="1" rowspan="1"><p class="c5 c4"><span class="c6 c0"></span></p><p class="c5"><span class="c6 c0">LwjglApplicationConfiguration config = new LwjglApplicationConfiguration();</span></p><p class="c5"><span class="c6 c0">config.foregroundFPS = 60;</span></p><p class="c5"><span class="c6 c0">new LwjglApplication(new MyGdxGame(), config);</span></p><p class="c5 c4"><span class="c0 c6"></span></p></td></tr></tbody></table><p class="c3"><span class="c0">&nbsp;</span></p><p class="c3"><span class="c0">I don&rsquo;t really recommend limiting it yourself using Thread.sleep(). Unless you are multi threading and you want to limit your secondary threads&rsquo; run per second.</span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3 c4"><span class="c0"></span></p><p class="c3 c4"><span class="c0"></span></p></body></html>